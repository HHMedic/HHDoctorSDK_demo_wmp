<!--components/hh-rtc/hh-rtc.wxml-->
<view class="container-box">
  <view class="camera-box">
    <webrtc-room id="webrtcroom" 
    template="{{template}}" 
    enableCamera="{{enableCamera}}" 
    roomID="{{roomID}}" 
    roomName="{{roomName}}" 
    userID="{{userID}}" 
    userSig="{{userSig}}" 
    sdkAppID="{{sdkAppID}}" 
    muted="{{muted}}" 
    debug="{{debug}}" 
    bindRoomEvent="onRoomEvent" 
    bindIMEvent="onIMEvent" 
    playerBackgroundImg='{{playerBackgroundImg+"?x-oss-process=image/resize,m_fixed,w_750"}}'        enableIM="{{enableIM}}" 
    smallViewRight="{{smallViewRight}}"
      smallViewTop="{{smallViewTop}}" smallViewWidth="{{smallViewWidth}}" smallViewHeight="{{smallViewHeight}}" members="{{members}}" systeminfo='{{systeminfo}}' startPlay='{{startPlay}}' isLivePusher='{{isLivePusher}}' orderid='{{orderid}}' minBitrate='{{minBitrate}}'
      maxBitrate='{{maxBitrate}}' status='{{status}}' loading='{{loading}}' waitPlay='{{waitPlay}}'>
      <block wx:if='{{status == 0}}'>
        <cover-view slot="{{template}}" class='room-box'>
          <cover-view class='transfer-text'>即将为您转呼...</cover-view>
          <!-- 遮罩层 -->
          <cover-image src='{{icons.mask}}' class='bottom-bg'></cover-image>
          <!-- 底部按钮组 -->
          <cover-view class='room-bottom'>
            <cover-view class='bottom-item'>
              <cover-image src='{{icons.camera}}' class='bottom-image'></cover-image>
              <cover-view>拍照</cover-view>
            </cover-view>
            <cover-view class='bottom-item'>
              <cover-image src='https://upload-images.jianshu.io/upload_images/5869240-49929cb9d539e0a9.png' class='bottom-image'></cover-image>
              <cover-view>挂断</cover-view>
            </cover-view>
            <cover-view class='bottom-item'>
              <cover-image src='{{icons.switch_camera}}' class='bottom-image'></cover-image>
              <cover-view>切换摄像头</cover-view>
            </cover-view>
          </cover-view>
        </cover-view>
      </block>

      <!-- 1.1 呼叫医生 -->
      <block wx:if='{{status == 1}}'>
        <cover-view slot="{{template}}" class='room-box'>
          <cover-view class='room-modal' wx:if='{{doctor.name}}'>
            <cover-view class='room-name'> {{doctor.name}} </cover-view>
            <cover-view class='room-status'>{{doctor.name?'呼叫中...':'拨号中...'}}</cover-view>
            <cover-view class='room-icon'>
              <cover-image src='{{icons.hangup}}' class='room-image' catchtap='bindHangUp' data-type='call_cancel'></cover-image>
              <cover-view class='room-cancel'>取消</cover-view>
            </cover-view>
          </cover-view>
        </cover-view>
      </block>

      <!-- 2.排队中 -->
      <block wx:if='{{status == 2}}'>
        <cover-view slot="{{template}}" class='room-box' wx:if='{{waitBox}}'>
          <!-- 初始不展示begin -->
          <cover-view class='wait-video-wrap' wx:if='{{waittingVideoTips}}'>
            <cover-view class='wait-video-box'>
              <cover-view class='wait-video-title'>{{preCallResponse.videoMsgMain}}</cover-view>
              <cover-view class='wait-video-title2'>{{preCallResponse.videoMsgSec}}</cover-view>
            </cover-view>
            <cover-view class='wait-time-tip' wx:if='{{msgTime}}'>{{msgTime}}</cover-view>
          </cover-view>
          <!-- 初始不展示end -->
          <cover-view class='room-modal'>
            <cover-view class='room-wait'>{{waitUserInfoText? waitUserInfoText:'目前咨询人数较多,感谢耐心等待'}}</cover-view>
            <cover-view class='room-status'>拨号中...</cover-view>
            <cover-view class='room-icon'>
              <cover-image src='{{icons.hangup}}' class='room-image' catchtap='bindHangUp' data-type='call_cancel'></cover-image>
              <cover-view class='room-cancel'>取消</cover-view>
            </cover-view>
          </cover-view>
        </cover-view>
        <!-- 播放视频时要显示的内容 -->
        <view slot='waitting' wx:if='{{!waitBox}}'>
          <hh-live request="{{_request}}" class="hh-live" height='{{systeminfo.screenHeight-110}}' bindclose="_onCloseVideo" bindinputcomment="_onInputComment" style='top:0;left:0;position:absolute;'></hh-live>
          <cover-view class='room-modal room-modal-wait'>
            <cover-view class='wait-text'>{{waitUserInfoText? waitUserInfoText:'目前咨询人数较多,感谢耐心等待'}}</cover-view>
            <cover-view class='wait-icon'>
              <cover-image src='{{icons.hangup}}' class='room-image' catchtap='bindHangUp' data-type='call_cancel'></cover-image>
            </cover-view>
          </cover-view>
        </view>
      </block>

      <!-- 3.视频中 -->
      <block wx:if='{{status == 3}}'>
        <cover-view slot="{{template}}" class='room-box' style='z-index:1000;'>
          <!-- logo -->
          <cover-image src='{{logoImage}}' wx:if='{{logoImage}}' class='logo-image' style='width:400rpx;height:{{logoHeight}}'></cover-image>
          <!-- 遮罩层 -->
          <cover-image src='{{icons.mask}}' class='bottom-bg'></cover-image>
          <!-- 右侧按钮组 -->
          <cover-view class='room-right'>
            <cover-view class='room-inner' style='height:{{isExpand?"auto":"0"}}'>
              <cover-view class='right-item right-certificate' catchtap="bindCertificateIcon" wx:if='{{doctor.license}}'>
                <cover-image src='{{icons.certificate}}' class='right-img '></cover-image>
                <cover-view>医师资格证书</cover-view>
              </cover-view>
              <cover-view class='right-item right-flash' catchtap="bindFlashIcon">
                <cover-image src='{{isFlash?icons.flash_on:icons.flash_off}}' class='right-img '></cover-image>
                <cover-view>闪光灯</cover-view>
              </cover-view>
            </cover-view>

            <cover-view class='right-arrow' catchtap="bindArrow">
              <cover-image src='{{isExpand?icons.arrow_down:icons.arrow_up}}' class='arrow-img'></cover-image>
            </cover-view>
          </cover-view>

          <!-- 执业医师资格证书预览模式 -->
          <cover-view class='cover-preview' wx:if='{{isCertificate}}' bindtap='bindCloseCertificate'>
            <cover-image src='{{doctor.license+"?x-oss-process=image/resize,m_fixed,w_400"}}' class='preview-img'></cover-image>
          </cover-view>

          <!-- 点击重传 两种状态（上传失败&上传成功）-->
          <cover-view class='cover-upload' bindtap='bindUploadPhotos' data-type='{{uploadFail?"upload":"preview"}}' wx:if='{{chooseImages.length}}'>
            <cover-image src='{{chooseImages[chooseImages.length-1]}}' class='upload-img'></cover-image>
            <cover-view class='upload-num' wx:if='{{uploadImages.length}}'>{{uploadImages.length}}</cover-view>
            <block wx:if='{{uploadFail}}'>
              <cover-image src='{{icons.warning}}' class='upload-icon'></cover-image>
              <cover-view class='upload-text'>点击重传</cover-view>
            </block>
          </cover-view>
          <!-- 已上传图片预览 -->
          <cover-view class='cover-preview' bindtap='bindPhotoPreview' bindtouchstart='touchstart' bindtouchend='touchend' wx:if='{{isPreviewPhoto}}'>
            <cover-view class='preview-count'>{{photoIdx+1}} / {{uploadImages.length}}</cover-view>
            <cover-image src='{{uploadImages[photoIdx]+"?x-oss-process=image/resize,m_fixed,w_750"}}' class='preview-img'></cover-image>
          </cover-view>

          <!-- 底部按钮组 -->
          <cover-view class='room-bottom'>
            <cover-view class='bottom-item' bindtap='bindCamera' wx:if='{{doctor.serviceTypeStatus!="zhuanke"}}'>
              <cover-image src='{{icons.camera}}' class='bottom-image'></cover-image>
              <cover-view>拍照</cover-view>
            </cover-view>
            <cover-view class='bottom-item' wx:else></cover-view>
            <cover-view class='bottom-item' bindtap='bindHangUp' data-type='interrupt'>
              <cover-image src='{{icons.hangup}}' class='bottom-image'></cover-image>
              <cover-view>挂断</cover-view>
            </cover-view>
            <cover-view class='bottom-item' bindtap='bindChangeCamera'>
              <cover-image src='{{icons.switch_camera}}' class='bottom-image'></cover-image>
              <cover-view>切换摄像头</cover-view>
            </cover-view>
          </cover-view>
          <!-- 计时 -->
          <cover-view class='video-time'>{{videoTime}}</cover-view>
        </cover-view>
      </block>

      <!-- 4.医生呼叫页面 -->
      <block wx:if='{{status == 4}}'>
        <cover-view class='room-box' slot='{{template}}'>
          <cover-view class='room-modal'>
            <cover-view class='room-name'> {{doctor.name}} </cover-view>
            <cover-view class='room-status'>邀请你视频...</cover-view>
            <cover-view class='room-icons'>
              <cover-view class='room-icon'>
                <cover-image src='{{icons.hangup}}' class='room-image' catchtap="bindDoctorHangUp"></cover-image>
                <cover-view class='room-cancel'>拒绝</cover-view>
              </cover-view>
              <cover-view class='room-icon'>
                <cover-image src='{{icons.accept}}' class='room-image' catchtap="bindDoctorAccept"></cover-image>
                <cover-view class='room-cancel'>接听</cover-view>
              </cover-view>
            </cover-view>
          </cover-view>
        </cover-view>
      </block>

      <!-- 5.专家呼叫页面 -->
      <block wx:if='{{status == 5}}'>
        <cover-view class='room-screen' slot='{{template}}'>
          <cover-view class='room-specialist'>
            <cover-image src='{{doctor.photourl}}' class='room-avatar'></cover-image>
            <cover-view class='room-name'>{{doctor.name}}</cover-view>
            <cover-view class='room-status'>正在向你发起视频...</cover-view>
          </cover-view>
          <cover-view class='room-icons'>
            <cover-view class='room-icon'>
              <cover-image src='{{icons.hangup}}' class='room-image' catchtap="bindDoctorHangUp"></cover-image>
              <cover-view class='room-cancel'>拒绝</cover-view>
            </cover-view>
            <cover-view class='room-icon'>
              <cover-image src='{{icons.accept}}' class='room-image' catchtap="bindDoctorAccept"></cover-image>
              <cover-view class='room-cancel'>接听</cover-view>
            </cover-view>
          </cover-view>
        </cover-view>
      </block>
      <!-- 未授权 -->
      <block wx:if='{{isAuthBox && _request.userToken && "unreg"!=_request.userToken}}'>
        <cover-view class='auth-box' slot='{{template}}'>
          <cover-view class='auth-text'>您未授权小程序使用您的麦克风或摄像头，无法使用相应功能</cover-view>
          <button class='auth-button' open-type="openSetting" catchtap='bindAuthButton'>现在去授权</button>
        </cover-view>
      </block>
    </webrtc-room>
  </view>
</view>