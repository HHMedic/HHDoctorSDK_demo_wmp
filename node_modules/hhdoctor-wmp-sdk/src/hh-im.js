// components/hh-im.js
const hhBehaviors = require('./hhBehaviors.js');
var that;
Component({
  behaviors: [hhBehaviors],
  /**
   * 组件的属性列表
   */
  properties: {
    callPage: {
      type: String,
      observer(newVal, oldVal, changedPath) {
        this.propertyChanged(newVal, oldVal, changedPath);
      }
    },

    viewTarget: {
      type: String
    },

    viewModule: {
      type: String,
      value: 'memberList'
    }
  },

  lifetimes: {
    attached() {
      that = this;
    },
    ready() {
      switch (that.data.viewTarget.toLowerCase()) {
        case 'im':
          that._viewIm();
          break;
        case 'ehr':
          that._viewEhr();
          break;
        default:
          break;
      }
    },
    detached() {

    }
  },

  /**
   * 组件的初始数据
   */
  data: {
    url: '',
    wmpHost: 'https://wmp.hh-medic.com/wmp/',
    ehrHost: 'https://e.hh-medic.com/ehrweb/'
  },

  /**
   * 组件的方法列表
   */
  methods: {
    propertyChanged(newVal, oldVal, changedPath) {
      //this._viewIm();
    },

    onWebLoad() {
      console.log('onWebLoad');
    },

    _viewIm() {
      if (!this.data.userUuid || !this.data.userToken ||
        !this.data.sdkProductId ||
        !this.data.openId || !this.data.callPage) {
        return;
      }
      var vParam = 'module=im' +
        '&appId=' + this.data.sdkProductId +
        //'&appKey=' + this.data.appKey +
        '&uuid=' + this.data.userUuid +
        '&token=' + this.data.userToken +
        '&openId=' + this.data.openId +
        '&version=3&callPage=' + encodeURIComponent(this.data.callPage);

      var s = that.data.wmpHost + 'view/?' + vParam;
      this.setData({
        url: s
      })
    },

    _viewEhr() {
      if (!this.data.userUuid || !this.data.userToken ||
        !this.data.sdkProductId ||
        !this.data.openId || !this.data.callPage) {
        return;
      }
      var vParam = 'module=' + this.data.viewModule +
        '&appId=' + this.data.sdkProductId +
        //'&appKey=' + this.data.appKey +
        '&uuid=' + this.data.userUuid +
        '&token=' + this.data.userToken +
        '&openId=' + this.data.openId;

      var s = that.data.ehrHost + 'view/?' + vParam;
      this.setData({
        url: s
      })
    }
  }
})